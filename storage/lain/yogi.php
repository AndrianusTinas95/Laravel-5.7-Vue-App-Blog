....
$pt=table_request::hasWhere('funsi relasi ke regex',function($q) use($file) {
    $q->where('id_upload',$file->id);
});

...
foreach(..)
$text=$value;

...

if(..){
    ......
    ...=$value->funsi relasi ke regex ()->first()->table_ip()->first()->table_ip;
    ...=$value->funsi relasi ke regex ()->first()->date;
    ...=$value->funsi relasi ke regex ()->first()->time;
    ...=$value->funsi relasi ke regex ()->get()->count();
}
.....